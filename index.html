<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LexPH: Ultimate Cloud Law Suite</title>
    <style>
        :root { --navy: #002147; --crimson: #800000; --gold: #b8860b; --bg: #f8f9fa; }
        body { font-family: 'Times New Roman', serif; background: var(--bg); margin: 0; display: flex; height: 100vh; }
        
        /* Navigation */
        nav { width: 280px; background: var(--navy); color: white; padding: 20px; display: flex; flex-direction: column; box-shadow: 2px 0 10px rgba(0,0,0,0.3); z-index: 10; }
        nav h1 { color: var(--gold); text-align: center; border-bottom: 2px solid var(--gold); padding-bottom: 10px; margin-bottom: 20px; }
        nav button { background: none; border: 1px solid rgba(255,255,255,0.1); color: white; padding: 12px; margin: 4px 0; cursor: pointer; text-align: left; border-radius: 4px; transition: 0.2s; font-size: 0.9rem; }
        nav button:hover, .active-nav { background: var(--crimson) !important; border-color: var(--gold); }

        /* Main Workspace */
        main { flex: 1; overflow-y: auto; padding: 30px; }
        .container { max-width: 900px; margin: auto; }
        .card { background: white; padding: 25px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); margin-bottom: 20px; }
        
        /* Search & UI */
        .search-container { position: sticky; top: -30px; background: var(--bg); padding: 10px 0; z-index: 5; margin-bottom: 20px; }
        #globalSearch { width: 100%; padding: 15px; border: 2px solid var(--navy); border-radius: 30px; font-size: 1rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .ratio-text { font-style: italic; color: #333; border-left: 4px solid var(--gold); padding-left: 15px; margin: 15px 0; line-height: 1.6; }
        .subject-tag { background: var(--gold); color: black; padding: 2px 8px; border-radius: 4px; font-size: 0.75rem; font-weight: bold; text-transform: uppercase; }
        
        /* Flashcard */
        .flash-card { height: 300px; background: white; border: 2px solid var(--gold); border-radius: 15px; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; padding: 30px; cursor: pointer; transition: transform 0.3s; }
        .flash-card:active { transform: scale(0.98); }

        .loader { display:none; color: var(--gold); font-size: 0.8rem; text-align: center; margin-top: 10px; }
    </style>
</head>
<body>

<nav>
    <h1>LexPH Alpha</h1>
    
    <button onclick="indexAllData()" style="color: var(--gold); border: 1px solid var(--gold); font-weight: bold; margin-bottom: 15px;">üîç Index All Modules</button>
    <div id="index-status" class="loader">Ready to search...</div>

    <div style="font-size: 0.75rem; color: #aaa; margin: 10px 0;">SUBJECT MODULES:</div>
    <button onclick="fetchModule('civil_law.json')">Civil Law</button>
    <button onclick="fetchModule('criminal_law.json')">Criminal Law</button>
    <button onclick="fetchModule('remedial_law.json')">Remedial Law</button>
    <button onclick="fetchModule('political_law.json')">Political Law</button>

    <div style="font-size: 0.75rem; color: #aaa; margin: 20px 0 10px;">STUDY TOOLS:</div>
    <button onclick="showView('db')" id="nav-db" class="active-nav">üìö Repository</button>
    <button onclick="showView('quiz')" id="nav-quiz">‚úçÔ∏è Quiz Mode</button>
    <button onclick="showView('flash')" id="nav-flash">üé¥ Flashcards</button>
</nav>

<main>
    <div class="container">
        
        <div class="search-container">
            <input type="text" id="globalSearch" placeholder="Instant Search: Type any keyword (e.g. 'Psychological', 'Due Process', 'Self-defense')..." onkeyup="handleSearch()">
        </div>

        <div id="view-db" class="view">
            <h2 id="view-title">Legal Repository</h2>
            <div id="db-content"></div>
        </div>

        <div id="view-quiz" class="view" style="display:none;">
            <h2>Knowledge Check</h2>
            <div id="quiz-area" class="card"></div>
        </div>

        <div id="view-flash" class="view" style="display:none;">
            <h2>Active Recall</h2>
            <div class="flash-card" onclick="flipFlash()">
                <div id="flash-display">Select a module or search for a case to begin.</div>
            </div>
            <button onclick="nextFlash()" style="margin-top:20px; width:100%; padding:15px; background:var(--navy); color:white; border:none; border-radius:8px; cursor:pointer;">Next Random Case</button>
        </div>

    </div>
</main>

<script>
    let activeDB = []; // Currently displayed data
    let globalIndex = []; // All data from all files
    let moduleFiles = ['civil_law.json', 'criminal_law.json', 'remedial_law.json', 'political_law.json'];
    let currentFlash = null;
    let isFlipped = false;

    // --- GLOBAL INDEXER ---
    async function indexAllData() {
        const status = document.getElementById('index-status');
        status.style.display = 'block';
        status.innerText = "Indexing all files...";
        globalIndex = [];
        
        for (let file of moduleFiles) {
            try {
                const res = await fetch(file);
                const data = await res.json();
                globalIndex = [...globalIndex, ...data];
            } catch (e) { console.log(`File ${file} not found.`); }
        }
        
        activeDB = globalIndex;
        status.innerText = `Search Ready: ${globalIndex.length} records`;
        renderDB();
    }

    // --- SEARCH LOGIC ---
    function handleSearch() {
        const term = document.getElementById('globalSearch').value.toLowerCase();
        const source = globalIndex.length > 0 ? globalIndex : activeDB;
        
        const filtered = source.filter(item => 
            item.title.toLowerCase().includes(term) || 
            item.ratio.toLowerCase().includes(term) ||
            (item.mnemonic && item.mnemonic.toLowerCase().includes(term))
        );
        
        renderDB(filtered);
    }

    // --- DATA FETCH ---
    async function fetchModule(file) {
        try {
            const res = await fetch(file);
            activeDB = await res.json();
            document.getElementById('view-title').innerText = file.replace('.json','').replace('_',' ').toUpperCase();
            renderDB();
            showView('db');
        } catch (e) { alert("File not found on GitHub yet."); }
    }

    function renderDB(data = activeDB) {
        const area = document.getElementById('db-content');
        if (data.length === 0) {
            area.innerHTML = "<p>No matches found. Try indexing all modules first.</p>";
            return;
        }
        area.innerHTML = data.map(item => `
            <div class="card">
                <span class="subject-tag">${item.subject || 'Law'}</span>
                <h3>${item.title}</h3>
                <p class="ratio-text">${item.ratio}</p>
                ${item.mnemonic ? `<div style="color:var(--navy); font-weight:bold;">Mnemonic: ${item.mnemonic}</div>` : ''}
            </div>
        `).join('');
    }

    function showView(v) {
        document.querySelectorAll('.view').forEach(x => x.style.display = 'none');
        document.querySelectorAll('nav button').forEach(b => b.classList.remove('active-nav'));
        document.getElementById('view-' + v).style.display = 'block';
        if(document.getElementById('nav-' + v)) document.getElementById('nav-' + v).classList.add('active-nav');
    }

    // --- FLASHCARD & QUIZ LOGIC (Simplified for integration) ---
    function nextFlash() {
        const pool = globalIndex.length > 0 ? globalIndex : activeDB;
        if(pool.length === 0) return;
        currentFlash = pool[Math.floor(Math.random() * pool.length)];
        isFlipped = false;
        document.getElementById('flash-display').innerHTML = `<h3>${currentFlash.title}</h3><p>(Click to flip)</p>`;
    }

    function flipFlash() {
        if(!currentFlash) return;
        const display = document.getElementById('flash-display');
        display.innerHTML = isFlipped ? 
            `<h3>${currentFlash.title}</h3><p>(Click to flip)</p>` : 
            `<p class="ratio-text">${currentFlash.ratio}</p><strong>${currentFlash.mnemonic || ''}</strong>`;
        isFlipped = !isFlipped;
    }
</script>
</body>
</html>
